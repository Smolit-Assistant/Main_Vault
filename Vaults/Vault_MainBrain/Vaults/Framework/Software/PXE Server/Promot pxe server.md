
Ich möchte den raspberry pi 400 als skript PXE-Boot-Server einrichten. Erstelle dazu ein script, welches die notwendigen Server installiert und überprüft, ob der rpi und die server koreckt konfiguriert werden müssen und anschließend die notwendigen konfigurationen vornimmt.
Erstelle ein ausführbares script ohne platzhalter. Schreibe vollständigen, ausführbaren code ohne platzhalter. 
Verwende folgende code snipets:


Snipet:
`#!/bin/bash  # Aktualisieren der Paketquellen sudo apt-get update  # Installieren der notwendigen Server sudo apt-get install -y dnsmasq tftpd-hpa nfs-kernel-server  # Sichern der Originalkonfigurationsdateien sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.backup sudo cp /etc/default/tftpd-hpa /etc/default/tftpd-hpa.backup  # Konfigurieren von dnsmasq cat <<EOT | sudo tee /etc/dnsmasq.conf interface=eth0 # Ändern Sie dies zu dem Netzwerk-Interface Ihres Raspberry Pi dhcp-range=192.168.1.50,192.168.1.150,12h # Ändern Sie dies zu Ihrem IP-Bereich dhcp-boot=pxelinux.0,raspberrypi,192.168.1.1 # Ändern Sie dies zu Ihrer Server-IP enable-tftp tftp-root=/tftpboot EOT  # Einrichten des TFTP-Servers sudo mkdir /tftpboot sudo chmod -R 777 /tftpboot sudo systemctl restart tftpd-hpa  # Einrichten des NFS-Servers sudo mkdir /nfsroot sudo chmod -R 777 /nfsroot  # NFS-Export hinzufügen echo "/nfsroot *(rw,sync,no_root_squash,no_subtree_check)" | sudo tee -a /etc/exports  # NFS und TFTP-Dienste neustarten sudo exportfs -ra sudo systemctl restart nfs-kernel-server sudo systemctl restart dnsmasq  echo "PXE-Boot-Server ist eingerichtet. Bitte überprüfen Sie die Konfigurationen und passen Sie sie an Ihre Bedürfnisse an."`

Snipet:

`#!/bin/bash  # Sicherstellen, dass das Skript bei einem Fehler stoppt set -e  # Standardkonfiguration STATIC_IP='192.168.1.2' NETMASK='255.255.255.0' GATEWAY='192.168.1.1' DNS='192.168.1.1' INTERFACE='eth0'  # Ports TFTP_PORT=69 DHCP_PORTS="67,68"  # Protokolldatei LOG_FILE="setup_pxe.log"  # Funktionen  ## Hilfe-Menü anzeigen show_help() { cat << EOF Usage: ${0##*/} [-i STATIC_IP] [-n NETMASK] [-g GATEWAY] [-d DNS] [-e INTERFACE]  Setzt einen PXE-Boot-Server auf einem Raspberry Pi auf.      -i STATIC_IP   Statische IP-Adresse des Raspberry Pi (Standard: $STATIC_IP)     -n NETMASK     Netzmaske des Netzwerks (Standard: $NETMASK)     -g GATEWAY     Standardgateway für das Netzwerk (Standard: $GATEWAY)     -d DNS         DNS-Server für das Netzwerk (Standard: $DNS)     -e INTERFACE   Netzwerkschnittstelle (Standard: $INTERFACE) EOF }  ## Benutzereingaben validieren validate_input() {     if ! [[ $STATIC_IP =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then         echo "Fehler: Ungültige IP-Adresse." >&2         exit 1     fi     # Weitere Validierungen können hier hinzugefügt werden }  ## Konfiguration der statischen IP configure_static_ip() {     echo "Konfiguriere statische IP $STATIC_IP für Interface $INTERFACE" | tee -a $LOG_FILE     # ... Konfigurationscode ... }  ## Firewall-Regeln überprüfen und setzen check_firewall_rules() {     # ... Firewall-Code ... }  ## IP-Weiterleitung überprüfen und setzen check_port_forwarding() {     # ... IP-Weiterleitung ... }  # Argumente verarbeiten while getopts "hi:n:g:d:e:" opt; do     case "$opt" in         h)             show_help             exit 0             ;;         i)  STATIC_IP=$OPTARG             ;;         n)  NETMASK=$OPTARG             ;;         g)  GATEWAY=$OPTARG             ;;         d)  DNS=$OPTARG             ;;         e)  INTERFACE=$OPTARG             ;;         *)             show_help >&2             exit 1             ;;     esac done  # Start des Skripts echo "Starte Setup des PXE-Servers..." | tee $LOG_FILE  validate_input configure_static_ip check_firewall_rules check_port_forwarding  echo "PXE-Server Setup abgeschlossen." | tee -a $LOG_FILE`

Snipet:

`#!/bin/bash  # Sicherstellen, dass das Skript bei einem Fehler stoppt set -e  # Standardkonfiguration STATIC_IP='192.168.1.2' NETMASK='255.255.255.0' GATEWAY='192.168.1.1' DNS='192.168.1.1' INTERFACE='eth0'  # Ports TFTP_PORT=69 DHCP_PORTS="67,68"  # Protokolldatei LOG_FILE="setup_pxe.log"  # Hilfe-Menü anzeigen show_help() { cat << EOF Usage: ${0##*/} [-i STATIC_IP] [-n NETMASK] [-g GATEWAY] [-d DNS] [-e INTERFACE]  Setzt einen PXE-Boot-Server auf einem Raspberry Pi auf.      -i STATIC_IP   Statische IP-Adresse des Raspberry Pi (Standard: $STATIC_IP)     -n NETMASK     Netzmaske des Netzwerks (Standard: $NETMASK)     -g GATEWAY     Standardgateway für das Netzwerk (Standard: $GATEWAY)     -d DNS         DNS-Server für das Netzwerk (Standard: $DNS)     -e INTERFACE   Netzwerkschnittstelle (Standard: $INTERFACE) EOF }  # Benutzereingaben validieren validate_input() {     if ! [[ $STATIC_IP =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]]; then         echo "Fehler: Ungültige IP-Adresse." >&2         exit 1     fi     # Weitere Validierungen können hier hinzugefügt werden }  # Konfiguration der statischen IP configure_static_ip() {     echo "Konfiguriere statische IP $STATIC_IP für Interface $INTERFACE" | tee -a $LOG_FILE     sudo cat <<EOT >> /etc/dhcpcd.conf interface $INTERFACE static ip_address=$STATIC_IP/$NETMASK static routers=$GATEWAY static domain_name_servers=$DNS EOT     sudo service dhcpcd restart }  # Firewall-Regeln überprüfen und setzen check_firewall_rules() {     # Überprüfen und Öffnen des TFTP-Ports     if ! sudo iptables -C INPUT -p udp --dport $TFTP_PORT -j ACCEPT &> /dev/null; then         sudo iptables -A INPUT -p udp --dport $TFTP_PORT -j ACCEPT         echo "TFTP-Port $TFTP_PORT geöffnet." | tee -a $LOG_FILE     fi      # Überprüfen und Öffnen der DHCP-Ports     for PORT in ${DHCP_PORTS//,/ }; do         if ! sudo iptables -C INPUT -p udp --dport $PORT -j ACCEPT &> /dev/null; then             sudo iptables -A INPUT -p udp --dport $PORT -j ACCEPT             echo "DHCP-Port $PORT geöffnet." | tee -a $LOG_FILE         fi     done      # Speichern der iptables-Regeln     sudo iptables-save | sudo tee /etc/iptables/rules.v4 > /dev/null }  # IP-Weiterleitung überprüfen und setzen check_port_forwarding() {     if [ $(sysctl net.ipv4.ip_forward) != "net.ipv4.ip_forward = 1" ]; then         echo "net.ipv4.ip_forward=1" | sudo tee -a /etc/sysctl.conf > /dev/null         sudo sysctl -p > /dev/null         echo "IP-Weiterleitung aktiviert." | tee -a $LOG_FILE     fi }  # Argumente verarbeiten while getopts "hi:n:g:d:e:" opt; do     case "$opt" in         h)             show_help             exit 0             ;;         i)  STATIC_IP=$OPTARG             ;;         n)  NETMASK=$OPTARG             ;;         g)  GATEWAY=$OPTARG             ;;         d)  DNS=$OPTARG             ;;         e)  INTERFACE=$OPTARG             ;;         *)             show_help >&2             exit 1             ;;     esac done  # Start des Skripts echo "Starte Setup des PXE-Servers..." | tee $LOG_FILE  validate_input configure_static_ip check_firewall_rules check_port_forwarding  echo "PXE-Server Setup abgeschlossen." | tee -a $LOG_FILE`


Snipet:

`#!/bin/bash  # Sicherstellen, dass das Skript bei einem Fehler stoppt set -e  # Standardkonfigurationen (können überschrieben werden) STATIC_IP='192.168.1.2' NETMASK='255.255.255.0' GATEWAY='192.168.1.1' DNS='192.168.1.1' INTERFACE='eth0'  # Ports TFTP_PORT=69 DHCP_PORTS="67,68"  # Protokolldatei LOG_FILE="setup_pxe.log"  # Hilfe-Menü anzeigen show_help() { cat << EOF Usage: ${0##*/} [-i STATIC_IP] [-n NETMASK] [-g GATEWAY] [-d DNS] [-e INTERFACE]  Setzt einen PXE-Boot-Server auf einem Raspberry Pi auf.      -i STATIC_IP   Statische IP-Adresse des Raspberry Pi (Standard: $STATIC_IP)     -n NETMASK     Netzmaske des Netzwerks (Standard: $NETMASK)     -g GATEWAY     Standardgateway für das Netzwerk (Standard: $GATEWAY)     -d DNS         DNS-Server für das Netzwerk (Standard: $DNS)     -e INTERFACE   Netzwerkschnittstelle (Standard: $INTERFACE) EOF }  # Funktion für die Eingabeaufforderung prompt_for_input() {     read -p "Geben Sie die statische IP-Adresse ein [$STATIC_IP]: " input     STATIC_IP=${input:-$STATIC_IP}      read -p "Geben Sie die Netzmaske ein [$NETMASK]: " input     NETMASK=${input:-$NETMASK}      read -p "Geben Sie das Gateway ein [$GATEWAY]: " input     GATEWAY=${input:-$GATEWAY}      read -p "Geben Sie den DNS-Server ein [$DNS]: " input     DNS=${input:-$DNS}      read -p "Geben Sie die Netzwerkschnittstelle ein [$INTERFACE]: " input     INTERFACE=${input:-$INTERFACE} }  # Rest des Skripts ...`


Snipet:
`#!/bin/bash  # Sicherstellen, dass das Skript bei einem Fehler stoppt set -e  # Standardkonfigurationen (können überschrieben werden) STATIC_IP='192.168.1.2' NETMASK='255.255.255.0' GATEWAY='192.168.1.1' DNS='192.168.1.1' INTERFACE='eth0'  # Ports TFTP_PORT=69 DHCP_PORTS="67,68"  # Protokolldatei LOG_FILE="setup_pxe.log" INTERACTIVE_MODE=false  # Hilfe-Menü anzeigen show_help() { cat << EOF Usage: ${0##*/} [-i] [-h] [--static-ip STATIC_IP] [--netmask NETMASK] [--gateway GATEWAY] [--dns DNS] [--interface INTERFACE]  Setzt einen PXE-Boot-Server auf einem Raspberry Pi auf.      -i, --interactive   Interaktiven Modus starten, um Benutzereingaben zu ermöglichen     -h, --help          Hilfe-Menü anzeigen     --static-ip         Statische IP-Adresse des Raspberry Pi (Standard: $STATIC_IP)     --netmask           Netzmaske des Netzwerks (Standard: $NETMASK)     --gateway           Standardgateway für das Netzwerk (Standard: $GATEWAY)     --dns               DNS-Server für das Netzwerk (Standard: $DNS)     --interface         Netzwerkschnittstelle (Standard: $INTERFACE) EOF }  # Funktion für die Eingabeaufforderung prompt_for_input() {     read -p "Geben Sie die statische IP-Adresse ein [$STATIC_IP]: " input     STATIC_IP=${input:-$STATIC_IP}      read -p "Geben Sie die Netzmaske ein [$NETMASK]: " input     NETMASK=${input:-$NETMASK}      read -p "Geben Sie das Gateway ein [$GATEWAY]: " input     GATEWAY=${input:-$GATEWAY}      read -p "Geben Sie den DNS-Server ein [$DNS]: " input     DNS=${input:-$DNS}      read -p "Geben Sie die Netzwerkschnittstelle ein [$INTERFACE]: " input     INTERFACE=${input:-$INTERFACE} }  # Rest des Skripts ...  # Argumente verarbeiten while [[ "$#" -gt 0 ]]; do     case "$1" in         -i|--interactive) INTERACTIVE_MODE=true; shift ;;         -h|--help) show_help; exit 0 ;;         --static-ip) STATIC_IP="$2"; shift; shift ;;         --netmask) NETMASK="$2"; shift; shift ;;         --gateway) GATEWAY="$2"; shift; shift ;;         --dns) DNS="$2"; shift; shift ;;         --interface) INTERFACE="$2"; shift; shift ;;         *) echo "Unknown option: $1" >&2; exit 1 ;;     esac done  if [ "$INTERACTIVE_MODE" = true ]; then     prompt_for_input fi  # Hier kommen die restlichen Teile des Skripts, wie Validierung, Konfiguration, usw.  echo "Setup des PXE-Servers abgeschlossen. Details: IP=$STATIC_IP, NETMASK=$NETMASK, GATEWAY=$GATEWAY, DNS=$DNS, INTERFACE=$INTERFACE" | tee -a $LOG_FILE`

Snipet:
`#!/bin/bash  # Sicherstellen, dass das Skript bei einem Fehler stoppt set -e  # Standardkonfigurationen (können überschrieben werden) STATIC_IP='192.168.1.2' NETMASK='255.255.255.0' GATEWAY='192.168.1.1' DNS='192.168.1.1' INTERFACE='eth0'  # Ports TFTP_PORT=69 DHCP_PORTS="67,68"  # Protokolldatei LOG_FILE="setup_pxe.log" INTERACTIVE_MODE=false  # Hilfe-Menü anzeigen show_help() { cat << EOF Usage: ${0##*/} [-i] [-h] [--static-ip STATIC_IP] [--netmask NETMASK] [--gateway GATEWAY] [--dns DNS] [--interface INTERFACE]  Setzt einen PXE-Boot-Server auf einem Raspberry Pi auf.      -i, --interactive   Interaktiven Modus starten, um Benutzereingaben zu ermöglichen     -h, --help          Hilfe-Menü anzeigen     --static-ip         Statische IP-Adresse des Raspberry Pi (Standard: $STATIC_IP)     --netmask           Netzmaske des Netzwerks (Standard: $NETMASK)     --gateway           Standardgateway für das Netzwerk (Standard: $GATEWAY)     --dns               DNS-Server für das Netzwerk (Standard: $DNS)     --interface         Netzwerkschnittstelle (Standard: $INTERFACE) EOF }  # Funktion für die Eingabeaufforderung prompt_for_input() {     read -p "Geben Sie die statische IP-Adresse ein [$STATIC_IP]: " input     STATIC_IP=${input:-$STATIC_IP}      read -p "Geben Sie die Netzmaske ein [$NETMASK]: " input     NETMASK=${input:-$NETMASK}      read -p "Geben Sie das Gateway ein [$GATEWAY]: " input     GATEWAY=${input:-$GATEWAY}      read -p "Geben Sie den DNS-Server ein [$DNS]: " input     DNS=${input:-$DNS}      read -p "Geben Sie die Netzwerkschnittstelle ein [$INTERFACE]: " input     INTERFACE=${input:-$INTERFACE} }  # Netzwerkkonfiguration anwenden configure_network() {     echo "Konfiguriere Netzwerk: $INTERFACE mit IP $STATIC_IP"     sudo cat <<EOT >> /etc/dhcpcd.conf interface $INTERFACE static ip_address=$STATIC_IP/$NETMASK static routers=$GATEWAY static domain_name_servers=$DNS EOT      sudo service dhcpcd restart }  # Firewall-Regeln anwenden configure_firewall() {     echo "Konfiguriere Firewall: Öffne Ports für TFTP und DHCP"          # TFTP     if ! sudo iptables -C INPUT -p udp --dport $TFTP_PORT -j ACCEPT &> /dev/null; then         sudo iptables -A INPUT -p udp --dport $TFTP_PORT -j ACCEPT     fi      # DHCP     for PORT in ${DHCP_PORTS//,/ }; do         if ! sudo iptables -C INPUT -p udp --dport $PORT -j ACCEPT &> /dev/null; then             sudo iptables -A INPUT -p udp --dport $PORT -j ACCEPT         fi     done      sudo iptables-save | sudo tee /etc/iptables/rules.v4 > /dev/null }  # Argumente verarbeiten while [[ "$#" -gt 0 ]]; do     case "$1" in         -i|--interactive) INTERACTIVE_MODE=true; shift ;;         -h|--help) show_help; exit 0 ;;         --static-ip) STATIC_IP="$2"; shift; shift ;;         --netmask) NETMASK="$2"; shift; shift ;;         --gateway) GATEWAY="$2"; shift; shift ;;         --dns) DNS="$2"; shift; shift ;;         --interface) INTERFACE="$2"; shift; shift ;;         *) echo "Unknown option: $1" >&2; exit 1 ;;     esac done  if [ "$INTERACTIVE_MODE" = true ]; then     prompt_for_input fi  # Netzwerkkonfiguration und Firewall-Regeln anwenden configure_network configure_firewall  echo "Setup des PXE-Servers abgeschlossen. Details: IP=$STATIC_IP, NETMASK=$NETMASK, GATEWAY=$GATEWAY, DNS=$DNS, INTERFACE=$INTERFACE" | tee -a $LOG_FILE`

